// client.js

document.addEventListener("DOMContentLoaded", () => {
    let gridContainer = document.getElementById("grid");
    let betAmountInput = document.getElementById("betAmount");
    let bombsInput = document.getElementById("bombs");
    let startButton = document.getElementById("startGame");
    let claimButton = document.getElementById("claimCoins");
    let messageDisplay = document.getElementById("message");
    let userCoinsDisplay = document.getElementById("userCoins");

    let userCoins = 100;
    let currentGrid = [];
    let currentMultiplier = 1;
    let gameInProgress = false;

    userCoinsDisplay.textContent = `Coins: ${userCoins}`;

    function generateGrid(bombs) {
        let grid = Array(25).fill("coin");
        for (let i = 0; i < bombs; i++) {
            let index;
            do {
                index = Math.floor(Math.random() * 25);
            } while (grid[index] === "bomb");
            grid[index] = "bomb";
        }
        return grid;
    }

    function calculateMultiplier(bombs) {
        return 1 + (bombs / 25) * 2;
    }

    function revealGrid() {
        gridContainer.innerHTML = "";
        currentGrid.forEach((cell, index) => {
            let cellElement = document.createElement("div");
            cellElement.classList.add("cell");
            cellElement.textContent = cell === "bomb" ? "ðŸ’£" : "ðŸ’°";
            gridContainer.appendChild(cellElement);
        });
    }

    function startGame() {
        let betAmount = parseInt(betAmountInput.value);
        let bombs = parseInt(bombsInput.value);

        if (betAmount < 1 || bombs < 1 || bombs >= 25 || !Number.isInteger(bombs)) {
            messageDisplay.textContent = "Invalid bet amount or number of bombs.";
            return;
        }

        if (userCoins < betAmount) {
            messageDisplay.textContent = "Insufficient coins.";
            return;
        }

        userCoins -= betAmount;
        userCoinsDisplay.textContent = `Coins: ${userCoins}`;

        currentGrid = generateGrid(bombs);
        currentMultiplier = calculateMultiplier(bombs);
        gameInProgress = true;
        claimButton.disabled = true;
        startButton.disabled = true;
        bombsInput.disabled = true;
        betAmountInput.disabled = true;

        gridContainer.innerHTML = "";
        for (let i = 0; i < 25; i++) {
            let cellElement = document.createElement("div");
            cellElement.classList.add("cell");
            cellElement.addEventListener("click", () => handleCellClick(i));
            gridContainer.appendChild(cellElement);
        }

        messageDisplay.textContent = "Game started! Click a square to reveal it.";
    }

    function handleCellClick(index) {
        if (!gameInProgress) return;

        let cellElement = gridContainer.children[index];
        let cellContent = currentGrid[index];
        
        if (cellContent === "bomb") {
            cellElement.textContent = "ðŸ’£";
            messageDisplay.textContent = "You hit a bomb! Game over.";
            gameInProgress = false;
            revealGrid();
            startButton.disabled = false;
            bombsInput.disabled = false;
            betAmountInput.disabled = false;
            return;
        }

        cellElement.textContent = "ðŸ’°";
        claimButton.disabled = false;
    }

    function claimCoins() {
        if (!gameInProgress) return;

        let betAmount = parseInt(betAmountInput.value);
        let winnings = betAmount * currentMultiplier;
        userCoins += winnings;
        userCoinsDisplay.textContent = `Coins: ${userCoins}`;
        messageDisplay.textContent = `You claimed ${winnings} coins!`;

        gameInProgress = false;
        revealGrid();
        startButton.disabled = false;
        bombsInput.disabled = false;
        betAmountInput.disabled = false;
    }

    startButton.addEventListener("click", startGame);
    claimButton.addEventListener("click", claimCoins);

    claimButton.disabled = true;
});

// Include this code within a <script> tag or link it to your HTML file hosted on GitHub Pages.
