// client.js

const baseUrl = 'https://replit.com/@kenster90/Website?v=1';
let currentGrid = [];
let currentBet = 0;
let currentMultiplier = 1;
let gameStarted = false;

// Initialize the game UI
document.addEventListener('DOMContentLoaded', () => {
    const startGameButton = document.getElementById('start-game');
    const betInput = document.getElementById('bet-input');
    const bombsInput = document.getElementById('bombs-input');
    const claimCoinsButton = document.getElementById('claim-coins');
    const gridContainer = document.getElementById('grid-container');

    // Disable claim button initially
    claimCoinsButton.disabled = true;

    // Start game button click event
    startGameButton.addEventListener('click', async () => {
        const betAmount = parseInt(betInput.value, 10);
        const bombs = parseInt(bombsInput.value, 10);

        if (isNaN(betAmount) || betAmount < 1 || isNaN(bombs) || bombs < 1 || bombs >= 25) {
            alert('Invalid bet amount or number of bombs. Ensure both are valid positive numbers.');
            return;
        }

        try {
            const response = await fetch(`${baseUrl}/start-game`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ betAmount, bombs })
            });
            const data = await response.json();

            if (data.success) {
                currentGrid = data.grid;
                currentBet = betAmount;
                currentMultiplier = data.multiplier;
                gameStarted = true;

                // Reset and render the grid
                gridContainer.innerHTML = '';
                for (let i = 0; i < 25; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.index = i;
                    cell.addEventListener('click', () => revealCell(i));
                    gridContainer.appendChild(cell);
                }

                claimCoinsButton.disabled = false;
                startGameButton.disabled = true;
                alert(`Game started! Multiplier: x${currentMultiplier.toFixed(2)}`);
            } else {
                alert(data.message);
            }
        } catch (error) {
            console.error('Error starting game:', error);
        }
    });

    // Claim coins button click event
    claimCoinsButton.addEventListener('click', async () => {
        if (!gameStarted) return;

        try {
            const response = await fetch(`${baseUrl}/claim-coins`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ betAmount: currentBet, multiplier: currentMultiplier })
            });
            const data = await response.json();

            if (data.success) {
                alert(`Coins claimed! You won ${data.winnings} coins. Total: ${data.totalCoins} coins.`);
                resetGame();
            } else {
                alert(data.message);
            }
        } catch (error) {
            console.error('Error claiming coins:', error);
        }
    });

    // Reveal cell function
    async function revealCell(index) {
        if (!gameStarted || !currentGrid.length) return;

        try {
            const response = await fetch(`${baseUrl}/reveal-cell`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ cellIndex: index, grid: currentGrid })
            });
            const data = await response.json();

            const cell = document.querySelector(`.cell[data-index='${index}']`);
            cell.classList.add('revealed');

            if (data.success) {
                cell.textContent = 'ðŸ’°';
            } else {
                cell.textContent = 'ðŸ’£';
                alert('Bomb revealed! Game over.');
                resetGame();
            }
        } catch (error) {
            console.error('Error revealing cell:', error);
        }
    }

    // Reset game function
    function resetGame() {
        currentGrid = [];
        currentBet = 0;
        currentMultiplier = 1;
        gameStarted = false;
        claimCoinsButton.disabled = true;
        startGameButton.disabled = false;
        gridContainer.innerHTML = '';
    }
});

// Additional CSS for shaking animation can be added in a separate stylesheet or within a <style> tag.
